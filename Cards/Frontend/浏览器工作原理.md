---
title: 浏览器工作原理
alias: 从输入url到页面展示，发生了什么？
date created: 2023-05-06
date modified: 2023-05-06
---

## 概述

### 浏览器的主要功能

浏览器的主要功能是通过从服务器上请求网络资源并在浏览器窗口中显示该资源，从而展示你选择的网络资源。该资源通常是一个HTML文档，但也可能是一个PDF、图片或其他类型的内容。资源的位置是由用户用URI（统一资源标识符）指定的。

浏览器解释和显示HTML文件的方式是在HTML和CSS规范中规定的。这些规范由W3C（万维网联盟）组织维护，该组织是网络的标准组织。

### 浏览器的高层结构

浏览器的主要组成部分是：

1.  用户界面：这包括地址栏、后退/前进按钮、书签菜单等。浏览器显示的每一个部分，除了你看到请求的页面的窗口。
2.  浏览器引擎：对用户界面和渲染引擎之间的动作进行管理。
3.  渲染引擎：负责显示请求的内容。例如，如果请求的内容是HTML，渲染引擎会解析HTML和CSS，并将解析后的内容显示在屏幕上。
4.  网络：用于网络调用，如HTTP请求，在一个与平台无关的接口后面为不同的平台使用不同的实现。
5.  UI后端：用于绘制基本的小工具，如组合框和窗口。这个后端暴露了一个通用的接口，不受平台限制。在这之下，它使用操作系统的用户界面方法。
6.  JavaScript 解释器。用来解析和执行JavaScript代码。
7.  数据存储。这是一个持久性层。浏览器可能需要在本地保存各种数据，如cookie。浏览器也支持存储机制，如localStorage、IndexedDB、WebSQL和FileSystem。

![[browser_components.png]]

需要注意的是，Chrome等浏览器运行多个渲染引擎的实例：每个标签页都有一个。每个标签都在一个单独的进程中运行。

### 渲染引擎

渲染引擎的职责是……渲染，也就是在浏览器屏幕上显示所请求的内容。

默认情况下，渲染引擎可以显示HTML、XML文档和图像。它可以通过插件或扩展来显示其他类型的数据；例如，使用PDF查看器插件来显示PDF文档。然而，在本章中，我们将重点讨论主要的使用情况：显示使用CSS格式化的HTML和图像。

> [!tip] 
> 在大多数情况下，浏览器被认为是单线程的。也就是说，他们从头到尾执行一项任务，然后再开始执行另一项任务。对于流畅的交互，开发人员的目标是确保高性能的站点交互，从流畅的滚动到对触摸的响应。渲染时间是关键，确保主线程可以完成我们交给它的所有工作，并且始终可以处理用户交互。可以通过了解浏览器的单线程特性并在可能和适当的情况下尽可能减少主线程的责任来提高 Web 性能，以确保渲染流畅并且对交互的响应是即时的。


## 主要流程

### 导航

导航是加载网页的第一步。每当用户通过在地址栏中输入 URL、单击链接、提交表单以及其他操作来请求页面时，它就会发生。

Web 性能的目标之一是最大限度地减少完成导航所需的时间。在理想情况下，这通常不会花费太长时间，但延迟和带宽是可能导致延迟的原因。

当用户在地址栏输入URL按下回车后，会进行HTTP请求，然后会发生DNS查询，IP寻址等过程。

#### DNS查询

你的浏览器请求进行[[DNS查询]]，最终由名称服务器进行现场处理，而名称服务器又会回应一个IP地址。在这个初始请求之后，该IP可能会被缓存一段时间，通过从缓存中检索IP地址而不是再次联系名称服务器来加快后续请求。

[[DNS查询]]通常只需要为每个主机名做一次页面加载。然而，DNS查询必须为请求的页面引用的每个独特的主机名进行。如果你的字体、图像、脚本、广告和指标都有不同的主机名，就必须为每个主机名进行DNS查询。


#### TCP

浏览器一旦知道了IP地址，浏览器就会通过[[TCP 协议]]建立与服务器的连接。这种机制的设计是为了让试图进行通信的两个实体--在这种情况下是浏览器和网络服务器--在传输数据之前协商网络TCP套接字连接的参数，通常是通过HTTPS。

TCP的三方握手技术通常被称为 "SYN-SYN-ACK"--或者更准确地说，是SYN、SYN-ACK、ACK--因为TCP有三个消息被传输，以协商和启动两台计算机之间的TCP会话。是的，这意味着每台服务器之间还要来回传递三条消息，而请求还没有发出。