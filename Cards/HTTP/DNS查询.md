---
title: DNS查询
date created: 2023-05-06
date modified: 2023-05-06
---

## 简介

DNS查询（也称为DNS请求）是从用户的计算机（DNS客户端）向DNS服务器发送的信息需求。在大多数情况下，发送DNS请求是为了询问与一个域名相关的IP地址。试图到达一个域名，实际上是一个DNS客户端查询DNS服务器，以获得与该域名相关的IP地址。

> [!tip]  
> DNS查询对互联网的运作至关重要。如果没有DNS查询，用户将不得不记住他们想要访问的网站的IP地址，这是不现实的。DNS查询允许用户使用他们的域名轻松访问网站，使互联网更方便用户使用。此外，DNS查询有助于在多个服务器上分配网络流量，从而提高网站性能，减少停机时间。

## DNS查询的类型

DNS查询主要有以下几种类型：

1. 递归查询（**Recursive** Query）：在这种查询中，客户端向DNS服务器发送一个查询请求，如果该服务器本身作为该域的权威服务器，它应该以正常的响应来回应。然而，如果服务器不是这个域名的权威服务器，它应该启动一个递归查询过程来解析域名本身，然后返回结果记录。
2. 非递归查询（**non-Recursive** Query）：在非递归查询中，预计DNS服务器会保留并返回所请求的主机名的答案。DNS服务器将继续从它自己的本地缓存或数据库返回答案。如果DNS服务器无法找到所请求的主机名的信息，它将以一个空响应代替。
3. 迭代查询（**Iterative** Query）：在迭代查询中，客户端向DNS服务器发送查询请求，而DNS服务器不会负责查询整个层次结构，而是会提供一个引用，指向另一个DNS服务器。客户端会继续向这些参考服务器发送查询，直到找到所需的信息。这种查询类型通常在DNS服务器之间进行查询时使用。
4. 反向查询（**Reverse** Query）：反向查询用于从IP地址查找域名，而不是从域名查找IP地址。这种查询类型在某些网络工具和日志分析中非常有用，它们需要将IP地址转换为易于阅读和理解的域名。

## How do they work?

递归DNS查询背后的过程，可以通过以下例子来解释：

1. 一个用户打开他最喜欢的浏览器，在地址栏中输入https://www.somedomain.com。他的计算机不知道www.somedomain.com 的IP地址，所以它向用户的DNS解析器发送了一个请求。
2. 解析器不知道www.somedomain.com的 IP 地址，所以它将查询一个根 DNS 服务器。
3. 根服务器知道所有顶级域名的位置，如.com，它们不知道www.somedomain.com 的 IP，所以它们返回.com 服务器的位置。
4. 一旦查询到达 .com TLD 服务器，它将找到 www.somedomain.com 的权威 DNS 服务器，并将用该服务器回复解析器。
5. 解析器将向该域名的权威DNS服务器发送查询，并将其解析。
6. 6.域名的权威 DNS 服务器将在其数据库中进行检查，并将找到一个 www.somedomain.com 的条目，该条目有一个 IP 地址。
7. 最后，解析器将知道www.somedomain.com 的IP地址，并将结果发送到用户的计算机。
  

非递归DNS查询的过程遵循相同的步骤，但DNS客户端（用户尝试解析域名的计算机）需要自己找到域名的权威DNS服务器。 DNS客户端需要先自行询问根服务器，然后是顶级域服务器，最后才是权威DNS服务器，以便能够解析域名。

## DNS查询记录的类型

有超过45种不同的查询和回答类型，旨在从名称服务器检索不同的信息。这些记录被映射到所谓的DNS记录，然后由服务器作为答案返回。在这45种以上的查询类型中，通常只有9种是大多数域名普遍使用的。这些是：

##### A记录

A记录将请求的主机名映射到相应的IPv4地址。这允许浏览器翻译域名，并将其路由到正确的服务器。

##### AAAA记录

AAAA记录类似于A记录，但是，它适用于IPv6地址。同样地，它允许浏览器将域名翻译到正确的服务器上。

##### CNAME记录

CNAME记录也被称为经典名称记录，它被用作另一个主机名的别名。当返回给客户时，客户将用另一个请求查询该主机名，将返回的别名解析为A或AAAA记录。服务器也可以在响应中包括这个记录。

##### MX记录

MX记录是Mail Exchanger的缩写，它指定了该域名的SMTP电子邮件服务器的主机名。然后，电子邮件服务将使用这个域名的传入电子邮件进行路由。

##### TXT记录

TXT或文本记录用于携带人类或机器可读的文本数据。这可以用于各种目的，如验证、认证或传递其他数据。

##### NS记录

NS记录是名称服务器记录的简称，它包含负责为被查询域提供DNS信息的名称服务器的信息，例如ns1.doman.com。

## DNS使用哪些网络协议？

一般来说，DNS查询是用UDP数据包发送的，由客户机传送到服务器。这主要是出于性能考虑，因为UDP通常被认为比其他标准网络协议快得多。如果由于某种原因，服务器没有回复，客户可能试图通过TCP连接重试连接。

服务器也可能要求客户使用TCP重新发送查询，以防DNS响应不适合UDP数据包。这使得服务器可以升级连接以返回长的响应。


## 参考文献

[What is a DNS Query? How does it work? | bunny.net](https://bunny.net/academy/dns/what-is-a-dns-and-recursive-query/)
[ClouDNS: What is a DNS query?](https://www.cloudns.net/wiki/article/254/)