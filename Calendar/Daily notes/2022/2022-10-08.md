# 2022.10.8 æ¯æ—¥æ€»ç»“

---

## 1. **å¦‚ä½•ç¼–å†™å¯ä»¥ä»ESM å‘½åå¯¼å…¥çš„ CommonJS å¯¼å‡º**

---

[How to write CommonJS exports that can be name-imported from ESM](https://2ality.com/2022/10/commonjs-named-exports.html)

### 1.1 **å¦‚ä½•ä» ESM æ¨¡å—å¯¼å…¥ CommonJS æ¨¡å—**

---

> å¯¼å…¥ CommonJS æ¨¡å—æ—¶ï¼Œmodule.exports ä½œä¸ºé»˜è®¤å¯¼å‡ºã€‚å‘½åå¯¼å‡ºå¯èƒ½æ˜¯å¯ç”¨çš„ï¼Œç”±é™æ€åˆ†ææä¾›ï¼Œä»¥æ–¹ä¾¿æ›´å¥½çš„ç”Ÿæ€ç³»ç»Ÿå…¼å®¹æ€§ã€‚
> 

æ¢å¥è¯è¯´ï¼š

- ä» CommonJS æ¨¡å—é»˜è®¤å¯¼å…¥æ€»æ˜¯æœ‰æ•ˆçš„ã€‚
- å‘½åå¯¼å…¥åœ¨ç‰¹å®šæƒ…å†µä¸‹æœ‰æ•ˆã€‚

### 1.2 **å¦‚ä½•ç¼–å†™å¯ä»¥å‘½åå¯¼å…¥çš„å¯¼å‡º**

---

è€ƒè™‘ä»¥ä¸‹ ESM æ¨¡å—ï¼š

```jsx
// main.mjs
import {namedExport} from './lib.cjs'; // (A)
console.log(namedExport); // 'yes'

```

å¦‚æœ CommonJS æ¨¡å—å¦‚ä¸‹æ‰€ç¤ºï¼Œåˆ™ A è¡Œä¸­çš„å¯¼å…¥æœ‰æ•ˆï¼š

```jsx
// lib.cjs
exports.namedExport = 'yes';
```

### 1.3 ****ä» CommonJS å¯¼å‡ºå¯¹è±¡ä¼šé˜»æ­¢å‘½åå¯¼å…¥****

---

åˆ†é…å¯¹è±¡ä»¥é˜²æ­¢å‘½åå¯¼å…¥ï¼š

```jsx
// lib.cjs
module.exports = {
  namedExport: 'yes',
};

```

å¦‚æœç°åœ¨è¿è¡Œï¼Œä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š

```
SyntaxError: Named export 'namedExport' not found.
```

### 1.4 è­¦å‘Šï¼šæ¥è‡ª CommonJS æ¨¡å—çš„å‘½åå¯¼å…¥ä¸æ˜¯åŠ¨æ€è¿æ¥

---

å‘½åçš„ CommonJS å¯¼å…¥ä¸æ˜¯åŠ¨æ€è¿æ¥ï¼š

```jsx
// main.mjs
import {namedExport, changeNamedExport} from './lib.cjs';

console.log(namedExport); // 'yes'
changeNamedExport();
console.log(namedExport); // 'yes'

```

```jsx
// lib.cjs
exports.namedExport = 'yes';
exports.changeNamedExport = () => {
  exports.namedExport = 'changed';
};
```

## 2. **å·§ç”¨:is()æˆ–:where()ä¼ªç±»è®©scopedçš„styleä¾ç„¶å…¨å±€åŒ¹é…**

`:is()`ä¼ªç±»å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§CSSä¹¦å†™è¯­æ³•ç³–ï¼Œå¯ä»¥ç®€åŒ–å¤æ‚ä¸”é‡å¤é€‰æ‹©å™¨çš„ä¹¦å†™ï¼Œä¾‹å¦‚ï¼š

```
.active > .class-a,
.active > .class-b,
.active > .class-c {
  display: block;
}
```

å¯ä»¥ç®€åŒ–æˆï¼š

```
active > :is(.class-a, .class-b, .class-c) {
  display: block;
}
```

`:where()`ä¼ªç±»çš„ä¼˜å…ˆçº§æ˜¯0ï¼Œæ— è®ºå…¶å‚æ•°å†…çš„é€‰æ‹©å™¨ä¼˜å…ˆçº§å¤šé«˜ï¼Œæ˜¯æ•´ä¸ªCSSä¸–ç•Œä¸­ä¸ºæ•°ä¸å¤šçš„å¯ä»¥é™ä½é€‰æ‹©å™¨ä¼˜å…ˆçº§çš„ç‰¹æ€§ï¼ˆå¦å¤–ä¸€ä¸ªæ˜¯ @layer è§„åˆ™ï¼Œè¯¦è§â€œ[è¯¦è§£æ—¥åå®šä¼šå¤§è§„æ¨¡ä½¿ç”¨çš„CSS @layer è§„åˆ™](https://www.zhangxinxu.com/wordpress/2022/05/css-layer-rule/)â€ä¸€æ–‡ï¼‰ã€‚

è€Œ`:is()`ä¼ªç±»çš„ä¼˜å…ˆçº§æ˜¯ç”±æ‹¬å·å†…é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§å†³å®šçš„ï¼Œä»è¿™ä¸€ç‚¹æ¥çœ‹ï¼Œ`:where()`ä¼ªç±»çš„ä½œç”¨å¯èƒ½è¿˜æ›´å¤§ä¸€ç‚¹ã€‚

**å…¼å®¹æ€§**

`:is()`ä¼ªç±»æ­£å¼æ”¯æŒæ˜¯Chrome88å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯21å¹´1æœˆä»½ï¼Œåˆ°ç°åœ¨å·²ç»å¿«2å¹´äº†ï¼Œé‚£äº›å¯¹å…¼å®¹æ€§è¦æ±‚ä¸é«˜çš„é¡¹ç›®å¯ä»¥æ”¾å¿ƒå¤§èƒ†ä½¿ç”¨ï¼Œå¦‚æœéè¦å…¼å®¹é™ˆæ—§æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨Â `:-webkit-any()`Â ä¼ªç±»å…¼å®¹ä¸‹ï¼Œé™¤äº†é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§ä¸ä¸€æ ·å¤–ï¼ˆ:any()ä¼ªç±»çš„ä¼˜å…ˆçº§æ’å®šä¸ºç±»é€‰æ‹©å™¨ä¼˜å…ˆçº§ï¼Œå¿½ç•¥é‡Œé¢çš„å‚æ•°ï¼‰ï¼Œå…¶ä»–åŠŸæ•ˆæ˜¯ä¸€æ ·çš„ï¼Œä¾‹å¦‚ï¼š

## 3. LRUç¼“å­˜ç®—æ³•

è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³Â  LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜ çº¦æŸçš„æ•°æ®ç»“æ„ã€‚
å®ç° `LRUCache` ç±»ï¼š

- `LRUCache(int capacity)` ä»¥ **æ­£æ•´æ•°** ä½œä¸ºå®¹é‡Â `capacity` åˆå§‹åŒ– LRU ç¼“å­˜
- `int get(int key)` å¦‚æœå…³é”®å­— `key` å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› `-1` ã€‚
- `void put(int key, int value)`Â å¦‚æœå…³é”®å­—Â `key` å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼Â `value` ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„Â `key-value` ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡Â `capacity` ï¼Œåˆ™åº”è¯¥ **é€å‡º** æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚

å‡½æ•° `get` å’Œ `put` å¿…é¡»ä»¥ `O(1)` çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚

<aside>
ğŸ’¡ æ€è·¯: put(key, value) æ¶‰åŠåˆ°`key-value`å› æ­¤æœ€å¥½ä½¿ç”¨`Map`æ¥è¿›è¡Œå­˜å‚¨ï¼Œåœ¨classé‡Œåˆå§‹åŒ–`capacity`å’Œ`map`ã€‚`put`æ—¶ä¾é `this.capacity` åˆ¤æ–­æ˜¯å¦è¦ **é€å‡º**ï¼Œå› ä¸º**Map**æ˜¯æœ‰åºçš„ï¼Œå› æ­¤æ’åœ¨`Map`æœ€å‰é¢çš„å…ƒç´ åº”è¯¥æ˜¯**æœ€ä¹…æœªä½¿ç”¨**çš„ï¼Œåœ¨è¶…å‡ºå®¹é‡æ—¶ç›´æ¥åˆ©ç”¨è¿­ä»£å™¨é€å‡ºç¬¬ä¸€ä¸ªå…ƒç´ å³å¯ï¼›`get`æ—¶åªéœ€åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨è¿”å›`-1` ï¼Œå­˜åœ¨çš„è¯éœ€è¦æ›´æ–°ç¼“å­˜ï¼Œåªéœ€åˆ é™¤è¿™ä¸ªå…ƒç´ å†é‡æ–°æ”¾ç½®å³å¯ã€‚

</aside>

```jsx
class LRUCache {
    capacity: number;
    cache: Map<number, number>;
    constructor(capacity: number) {
        this.capacity = capacity
        this.cache = new Map()
    }

    get(key: number): number {
        if (this.cache.has(key)) {
            let val = this.cache.get(key)
            this.cache.delete(key)
            this.cache.set(key,val)
            return val;
        }
        return -1;
    }

    put(key: number, value: number): void {
        if (this.cache.has(key)) {
            this.cache.delete(key)
            this.cache.set(key,value)
        }else {
            if (this.cache.size === this.capacity) {
                this.cache.delete(this.cache.keys().next().value)
            }
            this.cache.set(key,value)
        }
    }
}
```